---
output:
  pdfdocument:
    latexengine: xelatex
always_allow_html: yes
---
---
title: `r submitter`
---
 
```{r, include=FALSE, cache=FALSE, echo=FALSE}
library(knitr)
library(markdown)
library(rmarkdown)
```
 
 
```{r, echo=FALSE}
h <- hospital_metrics[hospital_metrics$SUBMITTERNAME==submitter,]
```
 
 
|      | Hospital || Hospital Rank | Virginia |
| -------------------------------------|--------|--------|---------|---------|
| **Number of samples submitted** | `r h$total_samples` | -- | -- | `r state$total_samples` |
| **Average transit time** | `r round(h$avg_transit_time, digits=2)` days | -- | `r h$rank_transit` of `r state$submitters` | `r round(state$avg_transit_time, digits=2)` days |
| **Samples collected at < 24 hours of age** | `r h$col_less_than_24_hours` | `r round(h$percent_less_than_24_hours, digits=4)*100`% | `r h$rank_early_collection` of `r state$submitters` | `r round(state$percent_less_than_24_hours, digits=4)*100`%
| **Samples transfused prior to collection** |  `r h$trans` | `r round(h$trans_percent, digits=4)*100`% |  `r h$rank_early_collection` of `r state$submitters`  |  `r round(state$trans_percent, digits=4)*100`% |
| **Unsatisfactory samples** | `r h$unsat_count` |  `r round(h$unsat_percent, digits=4)*100`% | `r h$rank_unsats` of `r state$submitters`  | `r round(state$unsat_percent, digits=4)*100`% | 
 
```{r echo=FALSE, results='markdown'}
# combine hospital's unsat counts with descriptions of codes
temp_unsats <- as.data.frame(t(select(h, unsat_1:unsat_13)))
names(temp_unsats) <- c('count')
unsats_count <- cbind(unsats, temp_unsats)
 
# remove all rows with NA for counts
unsats_final <- unsats_count[!is.na(unsats_count$count),]
 
# show unsat counts for each category if unsats final has 1 or more observations
if (nrow(unsats_final) > 0) {
  unsats_final <- unsats_final[,2:3]
  names(unsats_final) <- c('Unsatisfactory Samples','Count')
  kable(unsats_final, row.names=FALSE)
}
```
